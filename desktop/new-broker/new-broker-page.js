import { NewBrokerPage } from '../../base/new-broker/new-broker-page.js';
import { html } from '../../lib/template.js';
import { ref } from '../../lib/element/templating/ref.js';
import { css } from '../../lib/element/styles/css.js';
import { when } from '../../lib/element/templating/when.js';

import {
  basePageStyles,
  circleSvg,
  loadingIndicator
} from '../../design/leafygreen/styles/page.js';

import { SUPPORTED_BROKERS } from '../../base/new-broker/new-broker-page.js';
import { settings } from '../../design/leafygreen/icons/settings.js';

await i18nImport(['new-broker']);

const brokerSelectionTemplate = html`
  <div class="card-container">
    <${'ppp-generic-card'}>
      <svg slot="logo" height="40px" viewBox="0 0 242 80" fill="none"
           xmlns="http://www.w3.org/2000/svg">
        <g clip-path="url(#clip)">
          <path
            d="M113.4 73.7H117.3L115.3 68.1H115.2L113.4 73.7ZM113.8 65.5H116.9L122.3 79H119.2L118.1 76H112.5L111.3 79H108.4L113.8 65.5Z"
            fill="#0D47A1"/>
          <path
            d="M125.5 65.5H134.4V79H131.6V67.9H128V70.6C128 72.2 127.9 73.4 127.9 74.4C127.8 75.4 127.7 76.2 127.4 76.9C127.2 77.6 126.8 78.2 126.2 78.6C125.7 79 125 79.2 124 79.2C123.7 79.2 123.2 79.1 122.7 79L122.8 76.8C123.1 76.9 123.4 76.9 123.5 76.9C124.2 76.9 124.7 76.5 125 75.6C125.3 74.7 125.4 73.6 125.4 72.1C125.4 71.8 125.4 71.4 125.4 70.9C125.4 70.4 125.4 70 125.4 69.8V65.5H125.5Z"
            fill="#0D47A1"/>
          <path
            d="M143.3 67.2C142.7 67.2 142.1 67.3 141.6 67.6C141.1 67.9 140.6 68.4 140.2 69.1C139.8 69.9 139.6 70.9 139.6 72.2C139.6 73.5 139.8 74.5 140.2 75.3C140.6 76 141.1 76.5 141.6 76.8C142.2 77.1 142.7 77.2 143.3 77.2C143.7 77.2 144.1 77.1 144.5 77C144.9 76.9 145.3 76.6 145.7 76.3C146.1 75.9 146.4 75.4 146.6 74.7C146.8 74 147 73.2 147 72.2C147 70.9 146.8 69.9 146.4 69.1C146 68.4 145.5 67.9 145 67.6C144.5 67.4 143.9 67.2 143.3 67.2ZM143.3 65.3C144.6 65.3 145.7 65.6 146.7 66.1C147.7 66.6 148.5 67.4 149.1 68.5C149.7 69.5 150 70.8 150 72.2C150 73.6 149.7 74.9 149.1 76C148.5 77 147.7 77.8 146.7 78.4C145.7 78.9 144.6 79.2 143.3 79.2C142 79.2 140.9 78.9 139.9 78.4C138.9 77.9 138.1 77.1 137.5 76C136.9 75 136.6 73.7 136.6 72.2C136.6 70.8 136.9 69.5 137.5 68.5C138.1 67.5 138.9 66.7 139.9 66.1C140.9 65.6 142 65.3 143.3 65.3Z"
            fill="#0D47A1"/>
          <path
            d="M154.9 71.8H156.1C156.8 71.8 157.4 71.6 157.8 71.2C158.2 70.8 158.4 70.3 158.4 69.7C158.4 69.1 158.2 68.6 157.9 68.3C157.5 67.9 156.9 67.7 156.1 67.7H154.9V71.8ZM152.2 65.5H156.2C158.2 65.5 159.5 66 160.3 66.9C161 67.8 161.4 68.8 161.4 69.8C161.4 70.5 161.2 71.2 160.9 71.8C160.6 72.5 160 73 159.3 73.4C158.6 73.8 157.7 74 156.7 74H154.9V79H152.2V65.5Z"
            fill="#0D47A1"/>
          <path
            d="M173.1 72.8V76.9H174.8C175.4 76.9 176 76.8 176.5 76.5C177 76.2 177.2 75.7 177.2 74.9C177.2 74.1 176.9 73.5 176.5 73.3C176 73 175.4 72.9 174.8 72.9H173.1V72.8ZM170.3 65.5H179V67.9H173.1V70.7H175.3C176.4 70.7 177.4 70.9 178.1 71.3C178.8 71.7 179.3 72.2 179.6 72.9C179.9 73.6 180.1 74.3 180.1 75C180.1 75.5 180 75.9 179.8 76.4C179.6 76.9 179.3 77.3 178.9 77.7C178.5 78.1 178 78.4 177.4 78.6C176.8 78.8 176 78.9 175.2 78.9H170.2V65.5H170.3Z"
            fill="#0D47A1"/>
          <path
            d="M185.4 71.8H186.6C187.3 71.8 187.9 71.6 188.3 71.2C188.7 70.8 188.9 70.3 188.9 69.7C188.9 69.1 188.7 68.6 188.4 68.3C188 67.9 187.4 67.7 186.6 67.7H185.4V71.8ZM182.6 65.5H186.6C188.6 65.5 190 66 190.7 66.9C191.4 67.8 191.8 68.8 191.8 69.8C191.8 70.5 191.6 71.2 191.3 71.8C191 72.5 190.4 73 189.7 73.4C189 73.8 188.1 74 187.1 74H185.3V79H182.5V65.5H182.6Z"
            fill="#0D47A1"/>
          <path
            d="M200.1 67.2C199.5 67.2 199 67.3 198.4 67.6C197.8 67.9 197.4 68.4 197 69.1C196.6 69.9 196.4 70.9 196.4 72.2C196.4 73.5 196.6 74.5 197 75.3C197.4 76 197.9 76.5 198.4 76.8C199 77.1 199.5 77.2 200.1 77.2C200.5 77.2 200.9 77.1 201.3 77C201.7 76.9 202.1 76.6 202.5 76.3C202.9 75.9 203.2 75.4 203.4 74.7C203.7 74 203.8 73.2 203.8 72.2C203.8 70.9 203.6 69.9 203.2 69.1C202.8 68.4 202.3 67.9 201.8 67.6C201.3 67.4 200.7 67.2 200.1 67.2ZM200.1 65.3C201.4 65.3 202.5 65.6 203.5 66.1C204.5 66.6 205.3 67.4 205.9 68.5C206.5 69.5 206.8 70.8 206.8 72.2C206.8 73.6 206.5 74.9 205.9 76C205.3 77 204.5 77.8 203.5 78.4C202.5 78.9 201.3 79.2 200.1 79.2C198.8 79.2 197.7 78.9 196.7 78.4C195.7 77.9 194.9 77.1 194.3 76C193.7 75 193.4 73.7 193.4 72.2C193.4 70.8 193.7 69.5 194.3 68.5C194.9 67.5 195.7 66.7 196.7 66.1C197.7 65.6 198.8 65.3 200.1 65.3Z"
            fill="#0D47A1"/>
          <path
            d="M209 65.5H211.7V71.2H211.8L216.7 65.5H220L214.3 71.6L220.3 79H216.8L211.8 72.3H211.7V79H209V65.5Z"
            fill="#0D47A1"/>
          <path
            d="M221.8 65.5H229.9V67.9H224.6V70.9H229.4V73.1H224.6V76.6H229.9V79H221.8V65.5Z"
            fill="#0D47A1"/>
          <path
            d="M235 71.8H236.2C236.9 71.8 237.5 71.6 237.9 71.2C238.3 70.8 238.5 70.3 238.5 69.7C238.5 69.1 238.3 68.6 237.9 68.3C237.5 67.9 237 67.7 236.1 67.7H235V71.8ZM232.2 65.5H236.2C238.2 65.5 239.6 66 240.3 66.9C241 67.8 241.4 68.8 241.4 69.8C241.4 70.5 241.2 71.2 240.9 71.8C240.5 72.5 240 73 239.3 73.4C238.6 73.8 237.7 74 236.7 74H235V79H232.2V65.5Z"
            fill="#0D47A1"/>
          <path
            d="M104 41.3C103.5 41.2 103.1 41.2 102.8 41.2H102.4C102.2 41.2 102.1 41.2 102.1 41.2H101.5C99.5 41.2 92.5 41.2 83.9 41.2C80.2 41.2 76.2 41.2 72.2 41.2L76.1 49.9H83.9C89.3 49.9 94.1 49.9 97.4 49.9C91.3 61.3 74.6 70.5 54.4 70.4C41.4 70.4 29.7 66.7 21.5 60.9C13.3 55.1 8.7 47.6 8.7 39.6C8.7 31.6 13.3 24.1 21.5 18.2C29.7 12.4 41.4 8.7 54.4 8.7C66.3 8.7 77.1 11.8 85.2 16.8C87.2 18.1 89.9 17.5 91.2 15.4C92.5 13.4 91.8 10.7 89.8 9.4C80.1 3.5 67.8 0 54.4 0C39.8 0 26.4 4.2 16.5 11.1C6.6 18.1 0 28.1 0 39.6C0 51.1 6.6 61.1 16.5 68.1C26.4 75.1 39.7 79.2 54.4 79.2C80.3 79.1 102.6 66.3 107.8 47.1C108.3 42 104.1 41.4 104 41.3Z"
            fill="#0D47A1"/>
          <path
            d="M45.8 41.3L53.3 23.6L53.7 22.7V23.1L53.8 22.9L53.9 23.1V22.7L54.3 23.6L61.8 41.3C55.1 41.2 49.2 41.3 45.8 41.3ZM60.1 15.6C59.2 13.6 56.8 12.5 54.3 12.3C54.2 12.3 54 12.3 53.9 12.3H53.8C53.8 12.3 53.8 12.3 53.7 12.3C53.6 12.3 53.4 12.3 53.3 12.3C50.8 12.5 48.4 13.5 47.5 15.6L34.7 42.7L31.3 50L27.7 57.5C25.4 62.3 35.5 65.4 37 61.7L42 50H65.6L70.5 61.6C72.1 65.3 82.2 62.2 79.8 57.4L60.1 15.6Z"
            fill="#0D47A1"/>
        </g>
        <defs>
          <clipPath id="clip">
            <rect width="241.4" height="79.2" fill="white"/>
          </clipPath>
        </defs>
      </svg>
      <span slot="title">Alor Open API V2</span>
      <span slot="description">Торговля через Alor Open API. <a
        target="_blank"
        href="https://alor.dev/docs">Перейти к документации</a>.</span>
      <${'ppp-button'}
        @click="${(x) => (x.broker = SUPPORTED_BROKERS.ALOR_OPENAPI_V2)}"
        slot="action"
      >
        Продолжить
      </ppp-button>
    </ppp-generic-card>
    <ppp-generic-card>
      <svg slot="logo" xmlns="http://www.w3.org/2000/svg" height="40px"
           viewBox="0 0 119.904 18.224">
        <defs>
          <linearGradient gradientTransform="matrix(-1 0 0 1 3894.245 0)"
                          y2="49.001" x2="3893.389" y1="49.001"
                          x1="3864.982"
                          gradientUnits="userSpaceOnUse" id="a">
            <stop style="stop-color:#d81222" offset="0"/>
            <stop style="stop-color:#960b1a" offset="1"/>
          </linearGradient>
        </defs>
        <g transform="translate(13.083 -171.471)">
          <path style="fill:#000;stroke-width:.26458332" class="st0"
                d="M1.943 188.93H.038v-9.207h1.905ZM9.113 182.502c.45.37.661.979.661 1.825v4.604H7.95v-4.128c0-.37-.053-.635-.132-.82-.186-.344-.503-.529-1.006-.529-.608 0-1.005.265-1.243.767a2.77 2.77 0 0 0-.186 1.032v3.704H3.61v-6.826h1.72v1.006c.238-.344.45-.609.634-.768.37-.264.82-.423 1.403-.423.714 0 1.296.185 1.746.556zM10.648 183.454v-1.27h.952v-1.905h1.773v1.905h1.111v1.27h-1.111v3.598c0 .291.026.45.106.53.079.079.29.105.661.105h.371v1.323l-.9.027c-.847.026-1.429-.106-1.72-.45-.212-.212-.29-.53-.29-.952v-4.18zM19.96 182.263a2.9 2.9 0 0 1 1.192 1.006c.29.397.45.873.555 1.402.053.318.08.767.053 1.35h-4.974c.026.687.264 1.164.714 1.428.265.159.609.265.98.265.396 0 .74-.106.978-.318a1.42 1.42 0 0 0 .37-.476h1.826c-.053.397-.264.82-.661 1.244-.609.661-1.455 1.005-2.567 1.005-.9 0-1.72-.291-2.407-.847-.688-.555-1.032-1.481-1.032-2.725 0-1.19.317-2.09.952-2.725.635-.635 1.429-.953 2.434-.953.582.027 1.112.133 1.588.344zm-2.671 1.535c-.265.265-.424.609-.477 1.058h3.07c-.027-.476-.186-.82-.477-1.084a1.61 1.61 0 0 0-1.058-.37c-.45 0-.794.131-1.058.396zM26.576 181.972h.158v1.826c-.106 0-.211-.026-.29-.026h-.212c-.715 0-1.191.238-1.456.687-.132.265-.211.662-.211 1.218v3.254h-1.8v-6.8h1.694v1.19c.264-.45.503-.767.714-.925.344-.291.768-.424 1.297-.424.053-.026.08-.026.106 0zM30.465 184.803c.344-.052.582-.105.714-.158.265-.106.397-.265.397-.503 0-.291-.106-.476-.29-.582-.186-.106-.477-.159-.874-.159-.423 0-.74.106-.9.318-.132.158-.211.37-.264.635h-1.72c.027-.609.212-1.085.503-1.482.476-.609 1.296-.9 2.434-.9.74 0 1.429.16 2.01.45.583.291.874.847.874 1.667v3.916c0 .238.053.397.106.476a.72.72 0 0 0 .264.212v.264h-1.931a2.203 2.203 0 0 1-.106-.396c-.027-.133-.027-.265-.053-.424-.238.265-.53.503-.847.688-.396.212-.82.344-1.323.344-.608 0-1.137-.185-1.534-.53-.397-.343-.609-.846-.609-1.507 0-.847.318-1.455.98-1.826.37-.212.872-.344 1.587-.45zm1.085.82c-.106.08-.238.133-.344.186-.106.053-.265.08-.477.132l-.396.08c-.37.079-.662.158-.82.238-.292.158-.424.423-.424.767 0 .317.08.53.265.661.158.133.37.212.635.212.397 0 .74-.106 1.084-.344.318-.238.503-.635.503-1.243v-.688zM38.932 184.565a1.298 1.298 0 0 0-.265-.688c-.212-.264-.503-.423-.926-.423-.609 0-1.005.291-1.244.9-.105.317-.185.74-.185 1.27 0 .502.053.9.185 1.217.212.555.609.846 1.217.846.424 0 .715-.105.9-.344.185-.238.291-.529.318-.873h1.825a3.046 3.046 0 0 1-.582 1.535c-.556.767-1.376 1.164-2.487 1.164-1.111 0-1.905-.317-2.434-.979-.53-.661-.767-1.508-.767-2.54 0-1.164.29-2.09.846-2.725.582-.662 1.35-.98 2.381-.98.847 0 1.562.186 2.09.583.53.397.874 1.058.98 2.037zM41.34 183.454v-1.27h.952v-1.905h1.772v1.905h1.112v1.27h-1.112v3.598c0 .291.027.45.106.53.08.079.291.105.662.105h.37v1.323l-.873.027c-.847.026-1.429-.106-1.72-.45-.211-.212-.29-.53-.29-.952v-4.18zM48.166 181.31h-1.8v-1.64h1.8zm-1.826.821h1.8v6.826h-1.8zM53.96 182.131h1.905l-2.46 6.826h-1.88l-2.433-6.826h2.01l1.43 5.027zM61.077 182.263a2.9 2.9 0 0 1 1.19 1.006c.292.397.45.873.556 1.402.053.318.08.767.053 1.35h-4.974c.027.687.265 1.164.715 1.428.264.159.608.265.978.265.397 0 .741-.106.98-.318a1.42 1.42 0 0 0 .37-.476h1.825c-.052.397-.264.82-.661 1.244-.609.661-1.455 1.005-2.566 1.005-.9 0-1.72-.291-2.408-.847-.688-.555-1.032-1.481-1.032-2.725 0-1.19.317-2.09.952-2.725.635-.635 1.43-.953 2.435-.953.582.027 1.11.133 1.587.344zm-2.672 1.535c-.265.265-.423.609-.476 1.058h3.069c-.027-.476-.185-.82-.476-1.084a1.61 1.61 0 0 0-1.059-.37c-.45 0-.794.131-1.058.396zM64.04 179.75h3.97c1.084 0 1.851.317 2.301.952.265.37.397.82.397 1.323 0 .582-.159 1.059-.503 1.43-.158.184-.423.37-.74.528.476.185.82.37 1.058.609.423.397.608.952.608 1.667 0 .582-.185 1.137-.555 1.614-.556.714-1.455 1.084-2.673 1.084h-3.915v-9.207zm3.52 3.89c.529 0 .952-.08 1.243-.212.476-.239.688-.635.688-1.244 0-.608-.238-1.005-.74-1.217-.292-.106-.689-.185-1.244-.185h-2.25v2.857zm.423 4.233c.767 0 1.323-.212 1.64-.662.212-.29.318-.608.318-1.005 0-.662-.291-1.112-.9-1.376-.317-.132-.74-.185-1.27-.185h-2.487v3.228zM72.507 182.237h1.059v1.164c.079-.238.29-.503.635-.82.343-.318.74-.476 1.19-.476h.106c.053 0 .132 0 .265.026v1.19c-.08 0-.133-.026-.186-.026h-.185c-.555 0-1.005.186-1.296.556-.318.37-.45.794-.45 1.27v3.863h-1.138zM81.53 182.898c.582.583.9 1.43.9 2.54 0 1.085-.266 1.985-.795 2.673-.529.714-1.323 1.058-2.434 1.058-.926 0-1.64-.317-2.17-.926-.529-.635-.82-1.455-.82-2.514 0-1.137.291-2.01.847-2.698.556-.662 1.323-1.006 2.275-1.006.874.027 1.588.318 2.196.873zm-.715 4.472c.265-.556.423-1.19.423-1.879 0-.635-.105-1.137-.29-1.534-.318-.609-.847-.926-1.615-.926-.687 0-1.164.264-1.481.793-.318.53-.476 1.165-.476 1.905 0 .715.158 1.297.476 1.773.317.476.794.715 1.481.715.715 0 1.218-.291 1.482-.847zM83.673 179.75h1.084v5.344l2.884-2.857h1.43l-2.567 2.487 2.725 4.207H87.8l-2.117-3.413-.926.9v2.513h-1.084zM93.912 182.422c.45.212.794.503 1.005.873.212.344.37.741.45 1.19.08.318.106.795.106 1.483h-4.868c.026.688.185 1.217.476 1.64.291.423.767.609 1.376.609.582 0 1.058-.186 1.402-.583.185-.238.344-.476.423-.793h1.112c-.027.238-.133.529-.291.82-.16.291-.344.556-.556.74-.344.345-.767.556-1.27.689-.265.08-.582.106-.926.106-.82 0-1.535-.292-2.117-.9-.582-.609-.873-1.455-.873-2.54s.291-1.958.873-2.62c.582-.66 1.35-1.005 2.276-1.005.502-.053.952.08 1.402.291zm.423 2.646c-.053-.476-.158-.873-.317-1.164-.318-.556-.82-.82-1.535-.82-.502 0-.952.185-1.296.555-.344.37-.53.847-.556 1.429zM96.822 182.237h1.059v1.164c.08-.238.29-.503.635-.82.344-.318.74-.476 1.19-.476h.106c.053 0 .132 0 .265.026v1.19c-.08 0-.133-.026-.185-.026h-.186c-.555 0-1.005.186-1.296.556-.318.37-.45.794-.45 1.27v3.863h-1.138zM101.744 186.84c.026.371.132.662.29.874.292.37.794.555 1.509.555.423 0 .794-.079 1.138-.264.317-.185.476-.45.476-.847 0-.29-.133-.502-.397-.661-.159-.08-.503-.185-.98-.318l-.899-.238c-.582-.132-1.005-.29-1.296-.476-.503-.318-.74-.714-.74-1.27 0-.635.237-1.138.687-1.535.45-.397 1.085-.582 1.879-.582 1.031 0 1.772.291 2.222.9.291.37.423.794.423 1.217h-1.058a1.298 1.298 0 0 0-.265-.688c-.264-.291-.714-.45-1.375-.45-.424 0-.768.08-.98.238-.211.16-.343.37-.343.635 0 .291.158.53.45.688.158.106.423.185.74.265l.768.185c.82.185 1.375.397 1.666.582.45.291.662.74.662 1.35 0 .608-.238 1.11-.688 1.534-.45.423-1.164.662-2.09.662-1.006 0-1.72-.239-2.143-.688-.424-.45-.635-1.006-.688-1.694h1.032z"/>
          <path transform="matrix(.26458 0 0 .26458 -12.821 171.839)"
                style="fill:url(#a)" class="st1"
                d="M.9 64.6V33.4l28.4 31.2z"/>
          <circle style="fill:#d81222;stroke-width:.26458332" class="st2"
                  cx="-6.127" cy="182.687" r="2.249"/>
          <path transform="matrix(.26458 0 0 .26458 -12.821 171.839)"
                style="fill:#d81222" class="st2"
                d="M.9 33.4v31.2L29.3.5z"/>
        </g>
      </svg>
      <span slot="title">Interactive Brokers</span>
      <span slot="description">Торговля через IB. <a target="_blank"
                                                     href="https://www.interactivebrokers.co.uk/ru/index.php?f=5866">Перейти к документации</a>.</span>
      <ppp-button disabled slot="action">Продолжить</ppp-button>
    </ppp-generic-card>
    <ppp-generic-card>
      <svg slot="logo" height="40px" viewBox="0 0 301.4 146"
           xmlns="http://www.w3.org/2000/svg">
        <path style="fill:#a6abad"
              d="M122.5 129.652c-15.093-4.99-25.16-17.94-27.828-34.07-.622-3.76-.594-15.413-.44-29.582l.268-24.5 11.176-.282 11.176-.282.324 26.282c.31 25.187.421 26.48 2.661 31.028 2.744 5.571 5.95 8.35 11.294 9.79 7.445 2.004 15.052-1.723 19.147-9.38 2.111-3.949 2.237-5.492 2.532-30.938l.31-26.782 11.19.282 11.19.282.278 24.5c.156 13.766-.184 27.51-.778 31.37-2.134 13.891-9.655 24.224-21.775 29.918-5.938 2.79-7.896 3.19-16.725 3.423-6.303.166-11.479-.225-14-1.059zm100.7-1.852c-.906-.906-1.183-14.576-1.13-55.75.039-30.003.376-55.319.75-56.259C223.502 14.077 242.48 0 244.11 0c.477 0 .985 17.438 1.13 38.75l.261 38.75 13.854-18.25L273.21 41h11.427c9.338 0 11.534.28 12.014 1.531.378.984-4.192 7.837-12.781 19.168-7.353 9.7-13.737 18.376-14.187 19.28-.616 1.235 3.058 6.783 14.814 22.372 11.132 14.762 15.542 21.366 15.318 22.94-.3 2.115-.807 2.22-11.95 2.49l-11.638.28-15.363-20.616L245.5 87.828l-.272 19.79c-.196 14.302-.612 20.007-1.5 20.571-2.025 1.286-19.178.961-20.528-.389Zm-35.743-1.05c-.263-.688-.362-20.15-.218-43.25l.261-42 11.25-.283 11.25-.283V128h-11.031c-7.904 0-11.168-.354-11.512-1.25zm6.043-95.704c-6.58-2.721-9.476-12.113-5.647-18.308 1.154-1.867 3.255-3.922 4.67-4.566 5.654-2.577 13.611-.674 16.916 4.045 1.987 2.837 2.01 10.014.044 13.816-2.596 5.02-10.2 7.405-15.983 5.013z"
              transform="translate(.654 .437)"/>
        <path style="fill:#00a886"
              d="m66.492 139.274-9.992-6.726-10-.671c-6.454-.433-12.065-1.452-15.824-2.874C18.054 124.23 6.054 111.625 2.31 99.21-.072 91.305.013 78.205 2.496 70.5c4.086-12.675 15.39-24.55 28.18-29.601 8.366-3.305 25.244-3.321 33.564-.032 12.562 4.966 23.79 16.789 27.806 29.277 1.827 5.681 2.3 8.42 1.978 17.472-.339 9.526-.928 11.646-3.643 17.384-1.692 3.575-5.17 8.816-7.728 11.647L78 121.794v12.103c0 6.657-.34 12.103-.758 12.103-.416 0-5.254-3.027-10.75-6.726zm-7.403-31.819c11.082-5.616 16.41-18.416 12.529-30.1-6.058-18.238-29.664-23.586-42.809-9.698-9.168 9.686-8.772 26.895.815 35.393 5.034 4.463 6.384 5.259 11.182 6.59 5.878 1.63 12.26.867 18.283-2.185z"
              transform="translate(.654 .437)"/>
      </svg>
      <span slot="title">webQUIK</span>
      <span slot="description">Торговля через брокеров с поддержкой <a
        target="_blank"
        href="https://arqatech.com/ru/products/quik/terminals/user-applications/webquik/">webQUIK</a>.</span>
      <ppp-button disabled slot="action">Продолжить</ppp-button>
    </ppp-generic-card>
    <ppp-generic-card>
      <svg slot="logo" xmlns="http://www.w3.org/2000/svg" height="70px"
           viewBox="30 25 294 120" fill="none">
        <g>
          <path fill-rule="evenodd" clip-rule="evenodd"
                d="M49.6902 46.5848V54.5455H78.824V70.7617H49.6902V89.484C51.9085 90.516 54.2747 91.4005 56.6409 91.8428C70.8381 88.8944 84.1479 76.3636 84.4437 53.9558L84.5916 46.5848H49.6902Z"
                fill="#3E813D"/>
          <path
            d="M110.768 38.4767V42.7518H119.345V47.3219H110.768V54.9877H105V33.9066H120.085V38.4767H110.768Z"
            fill="black"/>
          <path
            d="M135.021 49.3858H130.585V54.9877H124.965V33.9066H135.909C137.683 33.9066 139.014 34.0541 140.049 34.4963C141.085 34.7912 141.824 35.5283 142.416 36.4128C143.007 37.2973 143.155 38.6241 143.155 40.3931C143.155 41.8673 143.155 42.8993 143.007 43.6364C142.859 44.3735 142.563 44.9631 141.972 45.5528C141.38 46.1425 140.493 46.5848 139.162 46.8796V47.1744C140.345 47.1744 141.232 47.6167 141.972 48.2064C142.711 48.7961 143.007 49.828 143.007 50.86V55.1351H137.387V52.1867C137.387 50.2703 136.648 49.3858 135.021 49.3858ZM130.732 44.5209H135.169C135.909 44.5209 136.5 44.3735 136.796 44.226C137.092 44.0786 137.387 43.7838 137.387 43.3415C137.535 42.8993 137.535 42.1622 137.535 41.2776C137.535 40.3931 137.387 39.656 137.092 39.3612C136.796 39.0663 136.204 38.9189 135.169 38.9189H130.732V44.5209Z"
            fill="black"/>
          <path
            d="M154.246 38.4767V42.457H163.268V46.2899H154.246V50.4177H164.007V54.9877H148.627V33.9066H163.859V38.4767H154.246Z"
            fill="black"/>
          <path
            d="M175.394 38.4767V42.457H184.415V46.2899H175.394V50.4177H185.155V54.9877H169.627V33.9066H185.007V38.4767H175.394Z"
            fill="black"/>
          <path
            d="M190.627 54.9877V33.9066H201.422C203.493 33.9066 205.12 34.2015 206.303 34.6437C207.486 35.2334 208.521 36.1179 209.113 37.2973C209.704 38.4767 210 40.0983 210 42.0147V46.4373C210 48.3538 209.704 49.9754 209.261 51.3022C208.817 52.4816 207.93 53.5135 206.894 54.1032C205.711 54.6929 204.232 54.9877 202.31 54.9877H190.627ZM196.246 38.7715V50.1229H201.127C203.049 50.1229 203.937 48.9435 203.937 46.5848V42.1622C203.937 41.2776 203.789 40.5405 203.641 40.0983C203.493 39.656 203.197 39.3612 202.753 39.0663C202.31 38.9189 201.866 38.7715 201.127 38.7715H196.246Z"
            fill="black"/>
          <path
            d="M224.493 55.2826C222.866 55.2826 221.535 55.1351 220.352 54.9877C219.169 54.8403 218.134 54.398 217.394 53.8083C216.507 53.2187 215.916 52.4816 215.472 51.4496C215.028 50.4177 214.732 49.0909 214.732 47.6167V41.7199C214.732 40.0983 215.028 38.9189 215.472 37.887C215.916 36.855 216.655 36.1179 217.394 35.5283C218.282 34.9386 219.317 34.6437 220.352 34.3489C221.535 34.2015 222.866 34.0541 224.493 34.0541C226.12 34.0541 227.451 34.2015 228.634 34.3489C229.817 34.4963 230.852 34.9386 231.592 35.5283C232.479 36.1179 233.07 36.855 233.514 37.887C233.958 38.9189 234.254 40.2457 234.254 41.7199V47.6167C234.254 49.2383 233.958 50.4177 233.514 51.4496C233.07 52.4816 232.331 53.2187 231.592 53.8083C230.704 54.398 229.669 54.6929 228.634 54.9877C227.451 55.1351 225.972 55.2826 224.493 55.2826ZM224.493 50.2703C225.528 50.2703 226.416 50.1228 226.859 49.9754C227.451 49.828 227.747 49.5332 228.042 48.9435C228.338 48.5012 228.486 47.7641 228.486 46.7322V42.0147C228.486 41.2776 228.486 40.5405 228.338 40.0983C228.19 39.656 228.042 39.3612 227.747 39.0663C227.451 38.7715 227.007 38.6241 226.563 38.6241C226.12 38.6241 225.38 38.4767 224.641 38.4767C223.606 38.4767 222.718 38.4767 222.275 38.6241C221.683 38.7715 221.387 39.0663 221.092 39.5086C220.796 39.9509 220.648 40.688 220.648 41.7199V46.4373C220.648 47.4693 220.796 48.2064 221.092 48.7961C221.387 49.2383 221.683 49.5332 222.275 49.6806C222.57 50.2703 223.458 50.2703 224.493 50.2703Z"
            fill="black"/>
          <path
            d="M244.606 38.9189L245.197 54.9877H239.43V33.9066H248.451L252.444 47.1744H252.739L256.585 33.9066H265.754V54.9877H260.134L260.577 38.9189H260.43L255.106 54.9877H250.225L244.754 38.9189H244.606Z"
            fill="black"/>
          <path
            d="M112.099 68.5504V70.3194H108.254V83.2924H106.035V70.3194H103.817V68.5504H106.035V66.3391C106.035 64.7174 106.479 63.5381 107.218 62.9484C107.958 62.3587 109.141 61.9165 110.915 61.9165L112.246 62.0639V63.8329C111.803 63.8329 111.507 63.6855 111.063 63.6855H110.62C109.732 63.6855 109.141 63.8329 108.845 64.2752C108.549 64.57 108.401 65.3071 108.401 66.1916V68.5504H112.099Z"
            fill="black"/>
          <path
            d="M117.423 64.57H115.204V62.2113H117.423V64.57ZM117.423 83.2924H115.204V68.5504H117.423V83.2924Z"
            fill="black"/>
          <path
            d="M123.93 74.2998V83.2924H121.711V68.5504H123.782V70.4668C124.373 69.5823 124.965 68.9926 126 68.6978C126.739 68.4029 127.627 68.2555 128.81 68.2555C130.88 68.2555 132.211 68.6978 133.099 69.4349C133.838 70.172 134.282 71.4988 134.282 73.5627V83.2924H132.063V73.7101C132.063 72.2359 131.768 71.2039 131.324 70.7617C130.88 70.3194 129.845 70.0246 128.366 70.0246C126.887 70.0246 125.704 70.3194 124.965 71.0565C124.373 71.6462 123.93 72.6781 123.93 74.2998Z"
            fill="black"/>
          <path
            d="M148.775 76.0688V74.0049C148.775 72.2359 148.479 71.0565 148.035 70.6142C147.591 70.172 146.408 69.8771 144.486 69.8771C143.155 69.8771 142.268 70.0246 141.676 70.3194C141.232 70.6142 140.937 71.2039 140.937 72.0885V72.5307H138.718C138.718 70.7617 139.31 69.4349 140.345 68.8452C141.084 68.4029 142.563 68.2555 144.486 68.2555C146.852 68.2555 148.331 68.5504 149.218 69.14C150.401 69.8771 150.845 71.3513 150.845 73.4152V83.145H148.775L148.922 81.2285C148.479 82.113 147.887 82.7027 147.296 82.9975C146.704 83.2924 145.521 83.4398 144.042 83.4398C141.972 83.4398 140.641 83.145 139.753 82.5553C138.718 81.8182 138.127 80.6388 138.127 78.7224C138.127 76.9533 138.57 75.774 139.606 75.0369C140.493 74.4472 141.824 74.1523 143.746 74.1523C145.373 74.1523 146.556 74.2998 147.296 74.4472C147.887 74.8894 148.331 75.4791 148.775 76.0688ZM148.775 79.0172C148.775 77.6904 148.479 76.9533 147.887 76.6585C147.296 76.3636 145.965 76.2162 143.894 76.2162C142.711 76.2162 141.824 76.3636 141.38 76.6585C140.789 77.1007 140.493 77.6904 140.493 78.7224C140.493 79.9017 140.789 80.7862 141.232 81.2285C141.676 81.6708 142.563 81.9656 143.894 81.9656C145.669 81.9656 146.852 81.8182 147.444 81.6708C148.183 81.0811 148.775 80.1966 148.775 79.0172Z"
            fill="black"/>
          <path
            d="M157.5 74.2998V83.2924H155.282V68.5504H157.352V70.4668C157.944 69.5823 158.535 68.9926 159.57 68.6978C160.31 68.4029 161.197 68.2555 162.38 68.2555C164.451 68.2555 165.782 68.6978 166.669 69.4349C167.408 70.172 167.852 71.4988 167.852 73.5627V83.2924H165.634V73.7101C165.634 72.2359 165.338 71.2039 164.894 70.7617C164.451 70.3194 163.416 70.0246 161.937 70.0246C160.458 70.0246 159.275 70.3194 158.535 71.0565C157.944 71.6462 157.5 72.6781 157.5 74.2998Z"
            fill="black"/>
          <path
            d="M182.345 77.9853H184.563C184.563 80.1966 184.12 81.6708 183.085 82.5553C182.197 83.2924 180.57 83.5872 178.204 83.5872C175.69 83.5872 174.063 82.9975 173.176 81.9656C172.289 80.9337 171.845 78.8698 171.845 75.9214C171.845 72.973 172.289 71.0565 173.176 69.8771C174.063 68.8452 175.69 68.2555 178.204 68.2555C180.275 68.2555 181.754 68.5504 182.641 69.14C183.824 69.8771 184.268 71.0565 184.268 72.8256V73.2678H182.049C182.049 72.0885 181.754 71.2039 181.31 70.7617C180.718 70.3194 179.683 70.0246 177.908 70.0246C176.282 70.0246 175.099 70.3194 174.655 71.0565C174.211 71.7936 173.916 73.2678 173.916 75.774C173.916 78.1327 174.211 79.7543 174.655 80.4914C175.247 81.2285 176.282 81.6708 177.908 81.6708C179.683 81.6708 180.718 81.3759 181.31 80.9337C182.049 80.4914 182.345 79.4595 182.345 77.9853Z"
            fill="black"/>
          <path
            d="M200.979 76.3636H190.331C190.331 78.5749 190.627 80.0491 191.07 80.7862C191.662 81.5233 192.697 81.8182 194.472 81.8182C196.246 81.8182 197.282 81.6708 197.873 81.3759C198.317 81.0811 198.613 80.344 198.613 79.312V78.8698H200.831C200.831 80.7862 200.239 82.113 199.204 82.8501C198.317 83.4398 196.69 83.7346 194.472 83.7346C191.958 83.7346 190.331 83.145 189.444 82.113C188.556 81.0811 188.113 79.0172 188.113 76.0688C188.113 73.2678 188.556 71.2039 189.592 70.172C190.627 68.9926 192.254 68.5504 194.62 68.5504C196.986 68.5504 198.613 69.14 199.5 70.172C200.535 71.2039 200.979 72.973 200.979 75.4791V76.3636ZM198.613 74.5946C198.613 72.8256 198.317 71.6462 197.725 71.0565C197.134 70.3194 196.099 70.0246 194.472 70.0246C192.845 70.0246 191.81 70.3194 191.218 71.0565C190.627 71.7936 190.331 72.973 190.331 74.5946H198.613Z"
            fill="black"/>
          <path
            d="M84.7394 46.5848L85.0351 29.3366C75.7182 28.5995 66.2534 28.1572 56.7887 28.1572C47.3239 28.1572 37.8591 28.5995 28.3943 29.3366L28.5422 42.8993L28.8379 53.9558C28.8379 53.9558 28.9858 64.2752 32.3872 71.6462C38.1548 85.0614 49.6901 89.484 49.6901 89.484V70.7617H78.8239V54.6929H49.6901V46.7322H84.7394V46.5848Z"
            fill="#6AB547"/>
        </g>
      </svg>
      <span slot="title">Freedom Finance</span>
      <span slot="description">Торговля через <a target="_blank"
                                                 href="https://tradernet.ru/tradernet-api/auth-login">Tradernet API</a>.</span>
      <ppp-button disabled slot="action">Продолжить</ppp-button>
    </ppp-generic-card>
    <ppp-generic-card>
      <div slot="logo">
        <svg height="40px" viewBox="0 0 34 48" style="margin-right: 8px">
          <path fill="#ed4040" fill-rule="evenodd" clip-rule="evenodd"
                d="M20 41V5h8v26c-.045 4.956-3.4 8.822-8 10zM6 31V5h8v36c-4.597-1.178-7.955-5.044-8-10zM0 0v29.63C.09 39.31 7.667 47 16.485 47 26.332 47 33.909 39.31 34 29.63V0H0z"></path>
        </svg>
        <svg height="40px" viewBox="0 0 90 38">
          <path fill="#000"
                d="M1.17 9.56c0 1.485.405 2.625 1.215 3.435.825.795 1.875 1.2 3.18 1.2 1.305 0 2.355-.405 3.18-1.215.825-.81 1.23-1.95 1.23-3.42V3.5h-1.65v6.12c0 1.965-1.095 3.03-2.76 3.03-1.665 0-2.745-1.065-2.745-3.03V3.5H1.17v6.06zM16.758 14V6.365L22.728 14h1.395V3.5h-1.62v7.605L16.578 3.5h-1.44V14h1.62zm14.406 0V3.5h-1.65V14h1.65zm4.59-8.985h3.464V14h1.65V5.015h3.48V3.5h-8.595v1.515zM56.507 14v-1.515h-6.015v-3.33h4.74V7.64h-4.74V5.015h5.82V3.5h-7.47V14h7.665zm8.35 0c1.695 0 3.06-.48 4.125-1.455 1.065-.975 1.605-2.25 1.605-3.795s-.54-2.805-1.605-3.78c-1.065-.975-2.43-1.47-4.125-1.47h-3.705V14h3.705zm-2.055-8.985h1.905c1.305 0 2.34.33 3.075 1.005.735.675 1.11 1.575 1.11 2.73s-.375 2.055-1.11 2.73c-.735.675-1.77 1.005-3.075 1.005h-1.905v-7.47zm-62.308 19H3.96V33h1.65v-8.985h3.48V22.5H.495v1.515zM15.235 33v-4.44h2.46L20.86 33h1.995l-3.3-4.62c1.44-.345 2.28-1.455 2.28-2.895 0-.885-.315-1.605-.93-2.16-.615-.555-1.47-.825-2.535-.825h-4.785V33h1.65zm0-8.985h3.03c1.2 0 1.905.57 1.905 1.53 0 1.005-.705 1.56-1.905 1.56h-3.03v-3.09zM28.066 33l1.125-2.61h4.98l1.14 2.61h1.77l-4.59-10.56h-1.59L26.311 33h1.755zm3.615-8.475l1.92 4.41h-3.84l1.92-4.41zM45.117 33c1.695 0 3.06-.48 4.125-1.455 1.065-.975 1.605-2.25 1.605-3.795s-.54-2.805-1.605-3.78c-1.065-.975-2.43-1.47-4.125-1.47h-3.705V33h3.705zm-2.055-8.985h1.905c1.305 0 2.34.33 3.075 1.005.735.675 1.11 1.575 1.11 2.73s-.375 2.055-1.11 2.73c-.735.675-1.77 1.005-3.075 1.005h-1.905v-7.47zM63.452 33v-1.515h-6.015v-3.33h4.74V26.64h-4.74v-2.625h5.82V22.5h-7.47V33h7.665zm6.294 0v-4.44h2.46L75.371 33h1.995l-3.3-4.62c1.44-.345 2.28-1.455 2.28-2.895 0-.885-.315-1.605-.93-2.16-.615-.555-1.47-.825-2.535-.825h-4.785V33h1.65zm0-8.985h3.03c1.2 0 1.905.57 1.905 1.53 0 1.005-.705 1.56-1.905 1.56h-3.03v-3.09zm15.366 9.18c1.155 0 2.115-.285 2.88-.84.765-.555 1.155-1.32 1.155-2.295-.06-1.185-.555-1.935-1.485-2.43-.66-.36-1.125-.54-1.92-.78l-1.2-.345c-.255-.105-.735-.255-.93-.375-.36-.255-.615-.495-.615-.945 0-.78.705-1.335 2.145-1.335 1.155 0 2.265.33 3.33.975v-1.65c-.975-.585-2.1-.87-3.36-.87-2.355 0-3.81 1.125-3.81 2.865 0 .96.315 1.635 1.08 2.115.39.225.735.405 1.05.525.315.12.78.27 1.365.435l.21.06c.675.195.96.27 1.44.495.24.105.42.21.54.315.255.225.465.555.465.975 0 .975-1.05 1.56-2.43 1.56-.72 0-1.44-.135-2.16-.405-.705-.27-1.275-.585-1.695-.96v1.785c1.035.75 2.34 1.125 3.945 1.125z"></path>
        </svg>
      </div>
      <span slot="title">United Traders</span>
      <span slot="description">Рыночные данные от <a target="_blank"
                                                 href="https://unitedtraders.biz/trading/aurora">United Traders</a>.</span>
      <ppp-button
        @click="${(x) => (x.broker = SUPPORTED_BROKERS.UNITED_TRADERS)}"
        slot="action"
      >Продолжить
      </ppp-button>
    </ppp-generic-card>
  </div>`;

const alorOpenAPIV2Template = html`
  <section>
    <div class="section-index-icon">${circleSvg(1)}</div>
    <div class="label-group">
      <h6>Название профиля</h6>
      <p>
        Произвольное имя, чтобы ссылаться на этот профиль, когда
        потребуется.
      </p>
      <${'ppp-text-field'}
        placeholder="Введите имя"
        name="profileName"
        ${ref('profileName')}
      ></ppp-text-field>
    </div>
  </section>
  <section>
    <div class="section-index-icon">${circleSvg(2)}</div>
    <div class="label-group">
      <h6>Токен для доступа к API</h6>
      <${'ppp-banner'} class="inline margin-top" appearance="warning">
        Токен будет сохранён в зашифрованном виде (по алгоритму
        AES-GCM).
      </ppp-banner>
      <p>
        Требуется для подписи всех запросов. Получить можно по
        <a target="_blank" href="https://alor.dev/open-api-tokens"
        >ссылке</a
        >. Если получаете впервые,
        <a target="_blank" href="https://alor.dev/register"
        >зарегистрируйтесь</a
        > предварительно.
      </p>
      <ppp-text-field
        placeholder="Alor refresh token"
        name="alorRefreshToken"
        ${ref('alorRefreshToken')}
      ></ppp-text-field>
    </div>
  </section>
`;

const unitedTradersTemplate = html`
  <section>
    <div class="section-index-icon">${circleSvg(1)}</div>
    <div class="label-group">
      <h6>Название профиля</h6>
      <p>
        Произвольное имя, чтобы ссылаться на этот профиль, когда
        потребуется.
      </p>
      <${'ppp-text-field'}
        placeholder="Введите имя"
        name="profileName"
        ${ref('profileName')}
      ></ppp-text-field>
    </div>
  </section>
  <section>
    <div class="section-index-icon">${circleSvg(2)}</div>
    <div class="label-group">
      <h6>Логин учётной записи United Traders</h6>
      <p>
        Учётную запись можно зарегистрировать по
        <a target="_blank"
           href="https://unitedtraders.biz/trading/aurora/auth/registration"
        >ссылке</a
        >.
      </p>
      <ppp-text-field
        placeholder="UT1234567"
        name="utLogin"
        ${ref('utLogin')}
      ></ppp-text-field>
    </div>
  </section>
  <section>
    <div class="section-index-icon">${circleSvg(3)}</div>
    <div class="label-group">
      <h6>Пароль учётной записи United Traders</h6>
      <${'ppp-banner'} class="inline margin-top" appearance="warning">
        Пароль будет сохранён в зашифрованном виде (по алгоритму
        AES-GCM).
      </ppp-banner>
      <${'ppp-text-field'}
        placeholder="Введите пароль"
        type="password"
        name="utPassword"
        ${ref('utPassword')}
      ></ppp-text-field>
    </div>
  </section>
`;

export const newBrokerPageTemplate = (context, definition) => html`
  <template>
    <${'ppp-page-header'}>Новый профиль брокера</ppp-page-header>
    ${when((x) => !x.broker, brokerSelectionTemplate)}
    <form ${ref(
      'form'
    )} id="new-broker" name="new-broker" onsubmit="return false">
      <div class="loading-wrapper" ?busy="${(x) => !!x.busy}">
        ${when((x) => x.broker === 'alor-openapi-v2', alorOpenAPIV2Template)}
        ${when((x) => x.broker === 'united-traders', unitedTradersTemplate)}
        ${when((x) => !!x.busy, html`${loadingIndicator()}`)}
      </div>
      ${when(
        (x) => x.broker,
        html`
          <section class="last">
            <div class="footer-actions">
              <${'ppp-button'}
                ?disabled="${(x) => !!x.busy}"
                type="submit"
                @click="${(x) => x.createBroker()}"
                appearance="primary"
              >
                ${when(
                  (x) => !!x.busy,
                  settings({
                    slot: 'end',
                    cls: 'spinner-icon'
                  })
                )}
                ${i18n.t('save')}
              </ppp-button>
            </div>
          </section>`
      )}
    </form>
  </template>
`;

export const newBrokerPageStyles = (context, definition) =>
  css`
    ${basePageStyles}
    .card-container {
      margin: 15px 0;
      display: grid;
      grid-template-columns: repeat(auto-fill, 450px);
      grid-gap: 10px 30px;
    }

    section ppp-text-field,
    section ppp-banner {
      max-width: 600px;
    }
  `;

export const newBrokerPage = NewBrokerPage.compose({
  baseName: 'new-broker-page',
  template: newBrokerPageTemplate,
  styles: newBrokerPageStyles
});
